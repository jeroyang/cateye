<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>ICD10.name</title>

    <!-- Bootstrap -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style media="screen">
      body {
        font-size: 1.7em;
      }
    </style>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-101904012-1', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-P3GR3HN');</script>
    <!-- End Google Tag Manager -->
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P3GR3HN"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <article class="container">
      <h1>ICD10.name</h1>
      <ul class="row nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#icd-10-cm" id="link-cm">CM (Diagnosis)</a></li>
          <li><a data-toggle="tab" href="#icd-10-pcs" id="link-pcs">PCS (Procedure)</a></li>
      </ul>
      <div class="row tab-content">
        <div id="icd-10-cm" class="tab-pane fade in active">
          <p></p>
          <div class="form-group has-feedback">
              <input type="text" class="form-control" id="inputbox-cm" placeholder="Search ICD-10-CM" style="font-size: 1.2em; height:50px;"/>
              <span class="glyphicon glyphicon-search form-control-feedback" style="margin: 10px;"></span>
          </div>
          <div class="response" id="response-cm">
            <!-- the response.html is inserted here-->
          </div>
        </div>
        <div id="icd-10-pcs" class="tab-pane fade">
          <p></p>
          <div class="form-group has-feedback">
              <input type="text" class="form-control" id="inputbox-pcs" placeholder="Search ICD-10-PCS"style="font-size: 1.2em; height:50px;"/>
              <span class="glyphicon glyphicon-search form-control-feedback" style="margin: 10px;"></span>
          </div>
          <div class="response" id="response-pcs">
            <!-- the response.html is inserted here-->
          </div>
        </div>
      </div>
    </article>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script type="text/javascript">
      $('#inputbox-cm').on('change', function(e) {
        $.get('/_search_cm', {s: $(this).val()}, function(data) {
          $('#response-cm').html(data);
        });
        var data = '?db=cm&s=' + $(this).val();
        var href = window.location.protocol+'//'+window.location.hostname+(location.port ? ':'+window.location.port: '') + '/' + data;
        history.pushState('', 'ICD10.name', href);
      });
      $('#inputbox-pcs').on('change', function(e) {
        $.get('/_search_pcs', {s: $(this).val()}, function(data) {
          $('#response-pcs').html(data);
        });
        var data = '?db=pcs&s=' + $(this).val();
        var href = window.location.protocol+'//'+window.location.hostname+(location.port ? ':'+window.location.port: '') + '/' + data;
        history.pushState('', 'ICD10.name', href);
      });
      $(document).on('touchstart', function() {
        documentClick = true;
      });
      $(document).on('touchmove', function() {
        documentClick = false;
      });
      $(document).on('touchend click', '#response-cm .hint a', function(e) {
        e.stopPropagation();
        e.preventDefault();
        if (e.type == "click") documentClick = true;
        if (documentClick) {
          var query = $('#inputbox-cm').val() + ' ' + $(this).text();
          $('#inputbox-cm').val(query);
          $('#inputbox-cm').trigger('change');
        }
      });
      $(document).on('touchend click', '#response-pcs .hint a', function(e) {
        e.stopPropagation();
        e.preventDefault();
        if (e.type == "click") documentClick = true;
        if (documentClick) {
          var query = $('#inputbox-pcs').val() + ' ' + $(this).text();
          $('#inputbox-pcs').val(query);
          $('#inputbox-pcs').trigger('change');
        }
      });
      $(document).on('touchend click', 'h4.cm a', function(e) {
        e.stopPropagation();
        e.preventDefault();
        if (e.type == "click") documentClick = true;
        if (documentClick) {
          var query = $(this).text();
          $('#inputbox-cm').val(query);
          $('#inputbox-cm').trigger('change');
        }
      });
      $(document).on('touchend click', 'h4.pcs a', function(e) {
        e.stopPropagation();
        e.preventDefault();
        if (e.type == "click") documentClick = true;
        if (documentClick) {
          var query = $(this).text();
          $('#inputbox-pcs').val(query);
          $('#inputbox-pcs').trigger('change');
        }
      });
      $(document).ready(function() {
        {% if db == 'cm' and s != '' %}
        $('#inputbox-cm').val('{{ s }}');
        $('#inputbox-cm').trigger('change');
        {% elif db == 'pcs' and s!= '' %}
        $('#link-pcs').trigger('click');
        $('#inputbox-pcs').val('{{ s }}');
        $('#inputbox-pcs').trigger('change');
        {% endif %}
      });
      $('#loadingDiv')
        .hide()  // Hide it initially
        .ajaxStart(function() {
            $(this).show();
        })
        .ajaxStop(function() {
            $(this).hide();
        });
      window.onpopstate = function(event) {
        location.reload();
      }
    </script>
  </body>
</html>
